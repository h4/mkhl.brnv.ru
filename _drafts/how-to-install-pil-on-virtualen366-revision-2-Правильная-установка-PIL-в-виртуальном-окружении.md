---
id: 369
title: Правильная установка PIL в виртуальном окружении
date: 2012-12-02T01:10:57+03:00
author: h4
layout: revision
guid: http://mkhl.brnv.ru/366-revision-2/
permalink: /366-revision-2/
---
Очередной переезд всех моих сайтов на новую виртуалку снова раз принёс кучу ошибок от джанги. Причина — _PIL_ (python image library) в виртуальном окружении собрался без поддержки _jpeg_ и _zlib_.

Причина проста до безобразия — инсталлятор не может найти нужные пакеты библиотек (почему — объясню чуть позже). В интернетах есть многочисленные решения, включающие скачивание исходников libjpeg, самостоятельную их сборку и явное указание путей к свежесобранной библиотеке в setup.py. Да, нужно не забыть сначала скачать исходники PIL, но не устанавливать, а потом установить, но не скачивать.

Есть другое решение, которое мне понравилось гораздо больше, но это решние требует наличия прав суперпользователя. Суть — положить библиотеки туда, где инсталлятор PIL предполагает их найти.

## Играем в бюро находок

Мне нужные jpeg и zlib, поэтому ставим из dev-версии:

    sudo apt-get install zlib1g-dev
    sudo apt-get install libjpeg-dev
    

Инсталлятор считает, что библиотеки будут в `/usr/lib`, однако в Ubutu они лежат совсем в другом каталоге, чтобы никто не расслаблялся. Симлинк нам в помощь:

    sudo ln -s /usr/lib/i386-linux-gnu/libz.so /usr/lib/
    sudo ln -s /usr/lib/i386-linux-gnu/libjpeg.so /usr/lib/
    

Если у вас вдруг 64-битная система — ищите библиотеки в `/usr/lib/x86_64-linux-gnu`.

Ставим PIL самым простым и обычным способом:

    pip install pil